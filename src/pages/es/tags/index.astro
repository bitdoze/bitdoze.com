---
import { getCollection } from 'astro:content';
import Layout from '@layouts/Layout.astro';
import { siteConfig } from '@config/site';
import { isPostIdInLocale } from '@utils/i18n';

const posts = await getCollection('posts', ({ id, data }) => !data.draft && isPostIdInLocale(id, 'es'));
const tags = [...new Set(posts.flatMap((post) => post.data.tags || []))];
const tagCounts = tags.map((tag) => ({
  name: tag,
  count: posts.filter((post) => post.data.tags?.includes(tag)).length,
  slug: tag.toLowerCase(),
})).sort((a, b) => b.count - a.count);
---

<Layout
  title={`Etiquetas - ${siteConfig.name}`}
  description="Etiquetas del contenido en espanol"
  lang="es"
  hreflangs={[
    { lang: "en", href: `${Astro.site || siteConfig.url}/tags/` },
    { lang: "es", href: `${Astro.site || siteConfig.url}/es/tags/` },
    { lang: "x-default", href: `${Astro.site || siteConfig.url}/tags/` },
  ]}
>
  <div class="w-full py-8">
    <header class="mb-10">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">Etiquetas</h1>
      <p class="text-lg text-gray-700 dark:text-gray-300">Explora articulos por etiqueta.</p>
    </header>

    <div class="flex flex-wrap gap-3">
      {tagCounts.map(({ name, count, slug }) => (
        <a
          href={`/es/tags/${slug}/`}
          class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 rounded-full shadow-sm hover:shadow-md transition-shadow border border-gray-200 dark:border-gray-700"
        >
          <span class="font-medium text-gray-900 dark:text-white">#{name}</span>
          <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs font-medium px-2.5 py-0.5 rounded-full">{count}</span>
        </a>
      ))}
    </div>
  </div>
</Layout>
